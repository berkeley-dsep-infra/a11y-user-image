#!/usr/bin/env bash
set -eux

# install pa11y tools for DH-169
npm install -g pa11y-ci@3.1.0
npm install -g pa11y@6.2.3

# webpdf
export PLAYWRIGHT_BROWSERS_PATH=${CONDA_DIR}
playwright install chromium

# Test if notebook can be converted to pdf
for notebook in image-tests/*.ipynb; do
    jupyter nbconvert --to webpdf "$notebook"
    if [ ! -f "${notebook%.ipynb}.pdf" ]; then
        echo "Error: PDF conversion failed for $notebook"
        exit 1
    fi
done

# Test if notebook can be converted to pdf
for notebook in image-tests/*.ipynb; do
    jupyter nbconvert --to webpdf "$notebook"
    if [ ! -f "${notebook%.ipynb}.pdf" ]; then
        echo "Error: PDF conversion failed for $notebook"
        exit 1
    fi
done

# Test if notebook can be converted to pdf
for notebook in image-tests/*.ipynb; do
    jupyter nbconvert --to webpdf "$notebook"
    if [ ! -f "${notebook%.ipynb}.pdf" ]; then
        echo "Error: PDF conversion failed for $notebook"
        exit 1
    fi
done
